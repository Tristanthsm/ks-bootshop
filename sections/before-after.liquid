{% liquid
  assign default_position = section.settings.default_position | default: 50
  assign before_image = section.settings.before_image
  assign after_image = section.settings.after_image
  assign aspect_ratio = section.settings.media_ratio | default: '16 / 9'
%}

<div
  id="before-after-{{ section.id }}"
  class="
    before-after-section
    {{ section.settings.bg_color }}
    {{ section.settings.bg_gradient }}
    {{ section.settings.text_color }}
    {{ section.settings.border_top_width | prepend: 'border-top-' }}
    {{ section.settings.border_bottom_width | prepend: 'border-bottom-' }}
    {{ section.settings.border_color }}
    {{ section.settings.pt | prepend: 'pt-' }}
    {{ section.settings.pb | prepend: 'pb-' }}
  "
  style="
    --bs-bg-opacity: {{ section.settings.bg_opacity | append: '%' }};
    --bs-border-opacity: {{ section.settings.border_opacity | append: '%' }};
  ">
  <div
    class="container"
    style="max-width: {{ section.settings.container_max_width }}px">
    <div class="row g-5 align-items-center">
      <div class="col-12 col-desktop-5">
        {% render 'section-header', class: 'text-desktop-start mb-4' %}
        {% unless section.settings.lead_text == blank %}
          <p class="lead fw-semibold opacity-80 mb-4">{{ section.settings.lead_text }}</p>
        {% endunless %}
        {% if section.blocks.size > 0 %}
          <ul class="before-after-list list-unstyled">
            {% for block in section.blocks %}
              <li class="before-after-list-item" {{ block.shopify_attributes }}>
                {% unless block.settings.icon == blank %}
                  <span class="before-after-list-icon" aria-hidden="true">{{ block.settings.icon }}</span>
                {% endunless %}
                <div class="before-after-list-content">
                  {% unless block.settings.title == blank %}
                    <p class="before-after-list-title h6 mb-1">{{ block.settings.title }}</p>
                  {% endunless %}
                  {% unless block.settings.description == blank %}
                    <div class="before-after-list-description rte small opacity-80 mb-0">{{ block.settings.description }}</div>
                  {% endunless %}
                </div>
              </li>
            {% endfor %}
          </ul>
        {% endif %}
        {% unless section.settings.cta_text == blank %}
          <div class="mt-4">
            <a class="btn {{ section.settings.cta_style }}" href="{{ section.settings.cta_url }}">{{ section.settings.cta_text }}</a>
          </div>
        {% endunless %}
      </div>
      <div class="col-12 col-desktop-7">
        <div
          class="before-after"
          data-before-after
          data-initial="{{ default_position }}"
          style="--before-after-position: {{ default_position }};">
          <div
            class="before-after-media"
            style="aspect-ratio: {{ aspect_ratio }};">
            {% if before_image != blank %}
              {% render 'image-url', img: before_image, size: 1280, orientation: section.settings.media_orientation, class: 'before-after-image before', loading: 'lazy', scale: true %}
            {% else %}
              <div class="before-after-placeholder before">
                {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
              </div>
            {% endif %}
            <div class="before-after-after">
              {% if after_image != blank %}
                {% render 'image-url', img: after_image, size: 1280, orientation: section.settings.media_orientation, class: 'before-after-image after', loading: 'lazy', scale: true %}
              {% else %}
                <div class="before-after-placeholder after">
                  {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
                </div>
              {% endif %}
            </div>
            {% unless section.settings.before_label == blank %}
              <span class="before-after-label before">{{ section.settings.before_label }}</span>
            {% endunless %}
            {% unless section.settings.after_label == blank %}
              <span class="before-after-label after">{{ section.settings.after_label }}</span>
            {% endunless %}
            <button
              type="button"
              class="before-after-handle"
              aria-label="{{ section.settings.slider_label | default: 'Déplacez le curseur pour comparer' }}">
              <span class="before-after-handle-icon" aria-hidden="true"></span>
            </button>
          </div>
          <div class="before-after-controls mt-3">
            {% unless section.settings.before_label == blank %}
              <span class="before-after-control-label">{{ section.settings.before_label }}</span>
            {% endunless %}
            <input
              type="range"
              class="form-range before-after-range"
              min="0"
              max="100"
              step="1"
              value="{{ default_position }}"
              aria-label="{{ section.settings.slider_label | default: 'Comparer les résultats' }}">
            {% unless section.settings.after_label == blank %}
              <span class="before-after-control-label">{{ section.settings.after_label }}</span>
            {% endunless %}
          </div>
        </div>
        {% unless section.settings.footnote == blank %}
          <p class="before-after-footnote small mt-3 mb-0 opacity-70">{{ section.settings.footnote }}</p>
        {% endunless %}
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Avant/après interactif",
  "tag": "section",
  "settings": [
    {
      "type": "header",
      "content": "Mise en page"
    },
    {
      "type": "select",
      "id": "bg_color",
      "label": "Couleur de fond",
      "default": "bg-body",
      "options": [
        { "value": "bg-primary", "label": "Primaire" },
        { "value": "bg-secondary", "label": "Secondaire" },
        { "value": "bg-body", "label": "Corps" },
        { "value": "bg-white", "label": "Blanc" }
      ]
    },
    {
      "type": "range",
      "id": "bg_opacity",
      "label": "Opacité du fond",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 100,
      "unit": "%"
    },
    {
      "type": "select",
      "id": "bg_gradient",
      "label": "Dégradé",
      "options": [
        { "value": "bg-gradient", "label": "Oui" },
        { "value": "", "label": "Non" }
      ],
      "default": ""
    },
    {
      "type": "select",
      "id": "text_color",
      "label": "Couleur du texte",
      "default": "text-body",
      "options": [
        { "value": "text-primary", "label": "Primaire" },
        { "value": "text-secondary", "label": "Secondaire" },
        { "value": "text-body", "label": "Corps" },
        { "value": "text-white", "label": "Blanc" }
      ]
    },
    {
      "type": "range",
      "id": "border_top_width",
      "label": "Largeur bord supérieur",
      "default": 0,
      "min": 0,
      "max": 16,
      "step": 1,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "border_bottom_width",
      "label": "Largeur bord inférieur",
      "default": 0,
      "min": 0,
      "max": 16,
      "step": 1,
      "unit": "px"
    },
    {
      "type": "select",
      "id": "border_color",
      "label": "Couleur de bordure",
      "default": "border-body",
      "options": [
        { "value": "border-primary", "label": "Primaire" },
        { "value": "border-secondary", "label": "Secondaire" },
        { "value": "border-body", "label": "Corps" },
        { "value": "border-white", "label": "Blanc" }
      ]
    },
    {
      "type": "range",
      "id": "border_opacity",
      "label": "Opacité des bordures",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 15,
      "unit": "%"
    },
    {
      "type": "range",
      "id": "pt",
      "label": "Marge supérieure",
      "default": 8,
      "min": 0,
      "max": 16,
      "step": 1
    },
    {
      "type": "range",
      "id": "pb",
      "label": "Marge inférieure",
      "default": 8,
      "min": 0,
      "max": 16,
      "step": 1
    },
    {
      "type": "range",
      "id": "container_max_width",
      "label": "Largeur max du contenu",
      "min": 720,
      "max": 1440,
      "step": 20,
      "unit": "px",
      "default": 1200
    },
    {
      "type": "header",
      "content": "Contenus"
    },
    {
      "type": "text",
      "id": "header_title",
      "label": "Titre",
      "default": "Un résultat visible dès la première utilisation"
    },
    {
      "type": "richtext",
      "id": "header_description",
      "label": "Description",
      "default": "<p>Comparez Aquasplash aux solutions traditionnelles et constatez la différence sur votre peau.</p>"
    },
    {
      "type": "text",
      "id": "lead_text",
      "label": "Phrase d'accroche",
      "default": "Un geste simple, une sensation de fraîcheur durable."
    },
    {
      "type": "image_picker",
      "id": "before_image",
      "label": "Image avant"
    },
    {
      "type": "image_picker",
      "id": "after_image",
      "label": "Image après"
    },
    {
      "type": "select",
      "id": "media_orientation",
      "label": "Orientation des images",
      "default": "ratio-4x3",
      "options": [
        { "value": "ratio-1x1", "label": "Carré" },
        { "value": "ratio-4x3", "label": "4:3" },
        { "value": "ratio-16x9", "label": "16:9" }
      ]
    },
    {
      "type": "select",
      "id": "media_ratio",
      "label": "Ratio d'affichage",
      "default": "16 / 9",
      "options": [
        { "value": "16 / 9", "label": "16:9" },
        { "value": "4 / 3", "label": "4:3" },
        { "value": "3 / 4", "label": "3:4" },
        { "value": "1 / 1", "label": "1:1" }
      ]
    },
    {
      "type": "range",
      "id": "default_position",
      "label": "Position initiale du curseur",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 55,
      "unit": "%"
    },
    {
      "type": "text",
      "id": "before_label",
      "label": "Libellé avant",
      "default": "Avant"
    },
    {
      "type": "text",
      "id": "after_label",
      "label": "Libellé après",
      "default": "Après"
    },
    {
      "type": "text",
      "id": "slider_label",
      "label": "Libellé pour le lecteur d'écran",
      "default": "Déplacez le curseur pour comparer"
    },
    {
      "type": "text",
      "id": "cta_text",
      "label": "Texte du bouton",
      "default": "Découvrir le kit complet"
    },
    {
      "type": "url",
      "id": "cta_url",
      "label": "Lien du bouton"
    },
    {
      "type": "select",
      "id": "cta_style",
      "label": "Style du bouton",
      "default": "btn-primary",
      "options": [
        { "value": "btn-primary", "label": "Primaire" },
        { "value": "btn-outline-primary", "label": "Primaire contour" },
        { "value": "btn-secondary", "label": "Secondaire" },
        { "value": "btn-outline-secondary", "label": "Secondaire contour" },
        { "value": "btn-white", "label": "Blanc" }
      ]
    },
    {
      "type": "text",
      "id": "footnote",
      "label": "Note complémentaire",
      "default": "* Résultats observés sur un panel de 50 testeurs après 7 jours d'utilisation."
    }
  ],
  "blocks": [
    {
      "type": "highlight",
      "name": "Argument",
      "settings": [
        {
          "type": "text",
          "id": "icon",
          "label": "Icône ou emoji",
          "default": "✨"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Titre",
          "default": "Peau apaisée"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Description",
          "default": "<p>Une brume fine qui respecte l'équilibre cutané.</p>"
        }
      ]
    }
  ],
  "max_blocks": 4,
  "presets": [
    {
      "name": "Avant/après interactif",
      "category": "Images",
      "blocks": [
        {
          "type": "highlight"
        },
        {
          "type": "highlight"
        }
      ]
    }
  ]
}
{% endschema %}
